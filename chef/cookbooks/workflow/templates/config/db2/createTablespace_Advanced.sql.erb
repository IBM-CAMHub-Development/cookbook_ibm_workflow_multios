-- =================================================================
-- Copyright 2018 IBM Corporation
--
-- Licensed under the Apache License, Version 2.0 (the "License");
-- you may not use this file except in compliance with the License.
-- You may obtain a copy of the License at
--
-- http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
-- =================================================================

--                                                                   
-- ***************************************************************** 
-- IBM Content Navigator configuration table creation script
-- for DB2 LUW
-- *****************************************************************

-- Connect to db
CONNECT TO <%=@CPEDB_NAME %>;
 
--  Create a schema for the application to use
CREATE SCHEMA ICNSA AUTHORIZATION <%=@DB2_USER %>;
-- Comments on the above statement. This is for sync. If the user who
-- creating the schema is the same as the one specified in db2inst1
-- this turns out to be a noop (the user who creates an object is already
-- authorized. This is generally the case in CMUI. If someone is manually
-- installing this, they *could* specify a different user. For sync, that
-- user must be able to create/drop tables in the schema for sync. The
-- 'AUTHORIZATION' directive accomplishes just that.
-- *****************************************************************
--  Create buffer pools and tablespaces for the application to use
CREATE Bufferpool WFICNTSBP IMMEDIATE SIZE AUTOMATIC PAGESIZE 32K;
CREATE Bufferpool WFICNTSTEMPBP IMMEDIATE SIZE 200 PAGESIZE 32K;
CREATE REGULAR TABLESPACE WFICNTS PAGESIZE 32 K 
	MANAGED BY AUTOMATIC STORAGE AUTORESIZE YES INITIALSIZE 20 M 
	INCREASESIZE 20 M BUFFERPOOL WFICNTSBP;
CREATE USER TEMPORARY TABLESPACE WFICNTSTEMP PAGESIZE 32K 
	MANAGED BY AUTOMATIC STORAGE BUFFERPOOL WFICNTSTEMPBP;
-- *****************************************************************

-- Close connection
CONNECT RESET;

-- Connect to db
CONNECT TO <%=@CPEDB_NAME %>;

-- Create Schema
CREATE SCHEMA TOSSA;
SET SCHEMA TOSSA;

-- Create 256MB GCD buffer pool
CREATE Bufferpool TOSSA_DATA_BP IMMEDIATE SIZE AUTOMATIC PAGESIZE 32K;
CREATE Bufferpool TOSSA_INDX_BP IMMEDIATE SIZE AUTOMATIC PAGESIZE 32K;

-- Create additional buffer pools
CREATE Bufferpool TOSSA_LOB_BP IMMEDIATE SIZE AUTOMATIC PAGESIZE 32K;
CREATE Bufferpool TOSSA_TEMP_BP IMMEDIATE SIZE AUTOMATIC PAGESIZE 32K;
CREATE Bufferpool TOSSA_SYS_BP IMMEDIATE SIZE AUTOMATIC PAGESIZE 32K;

CREATE STOGROUP TOSSADATA_SG ON '<%=@DB2_DATA_DIR %>/<%=@CPEDB_NAME %>/TOSSA/datafs1', '<%=@DB2_DATA_DIR %>/<%=@CPEDB_NAME %>/TOSSA/datafs2', '<%=@DB2_DATA_DIR %>/<%=@CPEDB_NAME %>/TOSSA/datafs3';
CREATE STOGROUP TOSSAINDX_SG ON '<%=@DB2_DATA_DIR %>/<%=@CPEDB_NAME %>/TOSSA/indexfs1', '<%=@DB2_DATA_DIR %>/<%=@CPEDB_NAME %>/TOSSA/indexfs2';
CREATE STOGROUP TOSSALOB_SG ON '<%=@DB2_DATA_DIR %>/<%=@CPEDB_NAME %>/TOSSA/lobfs1';

-- Create tablespaces
CREATE LARGE TABLESPACE TOSSA_DATA_TS PAGESIZE 32 K
MANAGED BY AUTOMATIC STORAGE
USING STOGROUP TOSSADATA_SG
EXTENTSIZE 16 OVERHEAD 10.5 PREFETCHSIZE 16 TRANSFERRATE 0.14
BUFFERPOOL TOSSA_DATA_BP DROPPED TABLE RECOVERY ON;

CREATE LARGE TABLESPACE TOSSA_IDX_TS PAGESIZE 32 K
MANAGED BY AUTOMATIC STORAGE
USING STOGROUP TOSSAINDX_SG
EXTENTSIZE 16 OVERHEAD 10.5 PREFETCHSIZE 16 TRANSFERRATE 0.14
BUFFERPOOL TOSSA_INDX_BP DROPPED TABLE RECOVERY ON;

CREATE LARGE TABLESPACE TOSSA_LOB_TS PAGESIZE 32 K
MANAGED BY AUTOMATIC STORAGE
USING STOGROUP TOSSALOB_SG
EXTENTSIZE 16 OVERHEAD 10.5 PREFETCHSIZE 16 TRANSFERRATE 0.14
BUFFERPOOL TOSSA_LOB_BP DROPPED TABLE RECOVERY ON;

CREATE USER TEMPORARY TABLESPACE TOSSA_TEMP_TS PAGESIZE 32 K
MANAGED BY AUTOMATIC STORAGE
EXTENTSIZE 16 OVERHEAD 10.5 PREFETCHSIZE 16 TRANSFERRATE 0.14
BUFFERPOOL TOSSA_TEMP_BP;

CREATE SYSTEM TEMPORARY TABLESPACE TOSSA_SYSTMP_TS PAGESIZE 32 K
MANAGED BY AUTOMATIC STORAGE
EXTENTSIZE 16 OVERHEAD 10.5 PREFETCHSIZE 16 TRANSFERRATE 0.14
BUFFERPOOL TOSSA_SYS_BP;

-- GRANT USE OF TABLESPACE TOSSA_DATA_TS TO user <%=@DB2_USER %>;
-- GRANT USE OF TABLESPACE TOSSA_IDX_TS TO user <%=@DB2_USER %>;
-- GRANT USE OF TABLESPACE TOSSA_LOB_TS TO user <%=@DB2_USER %>;
-- GRANT USE OF TABLESPACE TOSSA_TEMP_TS TO user <%=@DB2_USER %>;

---- GRANT IMPLICIT_SCHEMA ON DATABASE TO user db2admin;


-- Optionally, grant GROUP access to tablespaces
-- -- GRANT CREATETAB,CONNECT ON DATABASE  TO GROUP DB2USERS;
-- -- GRANT USE OF TABLESPACE USERTEMP1 TO GROUP DB2USERS;
-- -- GRANT USE OF TABLESPACE USERSPACE1 TO GROUP DB2USERS;

-- Close connection
CONNECT RESET;

-- Connect to db
CONNECT TO <%=@CPEDB_NAME %>;

-- Create Schema
CREATE SCHEMA DOSSA;
SET SCHEMA DOSSA;

-- Create 256MB GCD buffer pool
CREATE Bufferpool DOSSA_DATA_BP IMMEDIATE SIZE AUTOMATIC PAGESIZE 32K;
CREATE Bufferpool DOSSA_INDX_BP IMMEDIATE SIZE AUTOMATIC PAGESIZE 32K;

-- Create additional buffer pools
CREATE Bufferpool DOSSA_LOB_BP IMMEDIATE SIZE AUTOMATIC PAGESIZE 32K;
CREATE Bufferpool DOSSA_TEMP_BP IMMEDIATE SIZE AUTOMATIC PAGESIZE 32K;
CREATE Bufferpool DOSSA_SYS_BP IMMEDIATE SIZE AUTOMATIC PAGESIZE 32K;

CREATE STOGROUP DOSSADATA_SG ON '<%=@DB2_DATA_DIR %>/<%=@CPEDB_NAME %>/DOSSA/datafs1', '<%=@DB2_DATA_DIR %>/<%=@CPEDB_NAME %>/DOSSA/datafs2', '<%=@DB2_DATA_DIR %>/<%=@CPEDB_NAME %>/DOSSA/datafs3';
CREATE STOGROUP DOSSAINDX_SG ON '<%=@DB2_DATA_DIR %>/<%=@CPEDB_NAME %>/DOSSA/indexfs1', '<%=@DB2_DATA_DIR %>/<%=@CPEDB_NAME %>/DOSSA/indexfs2';
CREATE STOGROUP DOSSALOB_SG ON '<%=@DB2_DATA_DIR %>/<%=@CPEDB_NAME %>/DOSSA/lobfs1';

-- Create tablespaces
CREATE LARGE TABLESPACE DOSSA_DATA_TS PAGESIZE 32 K
MANAGED BY AUTOMATIC STORAGE
USING STOGROUP DOSSADATA_SG
EXTENTSIZE 16 OVERHEAD 10.5 PREFETCHSIZE 16 TRANSFERRATE 0.14
BUFFERPOOL DOSSA_DATA_BP DROPPED TABLE RECOVERY ON;

CREATE LARGE TABLESPACE DOSSA_IDX_TS PAGESIZE 32 K
MANAGED BY AUTOMATIC STORAGE
USING STOGROUP DOSSAINDX_SG
EXTENTSIZE 16 OVERHEAD 10.5 PREFETCHSIZE 16 TRANSFERRATE 0.14
BUFFERPOOL DOSSA_INDX_BP DROPPED TABLE RECOVERY ON;

CREATE LARGE TABLESPACE DOSSA_LOB_TS PAGESIZE 32 K
MANAGED BY AUTOMATIC STORAGE
USING STOGROUP DOSSALOB_SG
EXTENTSIZE 16 OVERHEAD 10.5 PREFETCHSIZE 16 TRANSFERRATE 0.14
BUFFERPOOL DOSSA_LOB_BP DROPPED TABLE RECOVERY ON;

CREATE USER TEMPORARY TABLESPACE DOSSA_TEMP_TS PAGESIZE 32 K
MANAGED BY AUTOMATIC STORAGE
EXTENTSIZE 16 OVERHEAD 10.5 PREFETCHSIZE 16 TRANSFERRATE 0.14
BUFFERPOOL DOSSA_TEMP_BP;

CREATE SYSTEM TEMPORARY TABLESPACE DOSSA_SYSTMP_TS PAGESIZE 32 K
MANAGED BY AUTOMATIC STORAGE
EXTENTSIZE 16 OVERHEAD 10.5 PREFETCHSIZE 16 TRANSFERRATE 0.14
BUFFERPOOL DOSSA_SYS_BP;

-- GRANT USE OF TABLESPACE DOSSA_DATA_TS TO user <%=@DB2_USER %>;
-- GRANT USE OF TABLESPACE DOSSA_IDX_TS TO user <%=@DB2_USER %>;
-- GRANT USE OF TABLESPACE DOSSA_LOB_TS TO user <%=@DB2_USER %>;
-- GRANT USE OF TABLESPACE DOSSA_TEMP_TS TO user <%=@DB2_USER %>;

---- GRANT IMPLICIT_SCHEMA ON DATABASE TO user db2admin;


-- Optionally, grant GROUP access to tablespaces
-- -- GRANT CREATETAB,CONNECT ON DATABASE  TO GROUP DB2USERS;
-- -- GRANT USE OF TABLESPACE USERTEMP1 TO GROUP DB2USERS;
-- -- GRANT USE OF TABLESPACE USERSPACE1 TO GROUP DB2USERS;

-- Close connection
CONNECT RESET;
